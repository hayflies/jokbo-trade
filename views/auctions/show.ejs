<%- include('../partials/header', { title: auction.title }) %>
<section class="card" data-auction-detail data-auction-id="<%= auction.id %>">
  <header class="card-header">
    <h2><%= auction.title %></h2>
    <p class="muted">판매자 닉네임: <%= auction.sellerNickname %></p>
  </header>
  <div class="auction-meta">
    <p>현재가: <strong class="price" data-current-price>₩<%= auction.currentPrice.toLocaleString('ko-KR') %></strong></p>
    <p>마감 예정: <time data-end-time datetime="<%= auction.endTime.toISOString() %>"><%= auction.endTime.toLocaleString('ko-KR') %></time></p>
    <p>총 입찰 수: <span data-bid-count><%= auction.bids.length %></span></p>
    <a class="btn-secondary" href="/auctions/<%= auction.id %>/download">자료 다운로드</a>
  </div>
  <section class="auction-description">
    <h3>설명</h3>
    <p><%= auction.description %></p>
  </section>
  <section class="auction-bids">
    <h3>입찰 내역</h3>
    <ul class="bid-list" data-bid-list>
      <% auction.bids.slice().reverse().forEach(function (bid) { %>
      <li>
        <span><%= bid.bidderNickname %></span>
        <span>₩<%= bid.amount.toLocaleString('ko-KR') %></span>
        <time><%= new Date(bid.createdAt).toLocaleString('ko-KR') %></time>
      </li>
      <% }); %>
    </ul>
  </section>

  <section class="bid-form">
    <h3>입찰하기</h3>
    <form action="/auctions/<%= auction.id %>/bids" method="post" class="form-inline" data-bid-form>
        <label>
            <input type="number" name="amount" min="1" step="100" placeholder="입찰 금액" required />
        </label>
        <button type="submit" class="btn-primary">입찰</button>
    </form>
  </section>

  <section class="reputation-form">
    <h3>판매자 평가</h3>
    <form action="/auctions/<%= auction.id %>/rate" method="post" class="form-grid">
      <label>평점 (1-5)
        <input type="number" name="score" min="1" max="5" required />
      </label>
      <label>한 줄 평
        <textarea name="comment" rows="2" placeholder="거래 경험을 공유해주세요"></textarea>
      </label>
      <button type="submit" class="btn-secondary">평가 등록</button>
    </form>
  </section>

  <section class="audit-log">
    <h3>MariaDB 거래 로그</h3>
    <table>
      <thead>
        <tr>
          <th>익명 닉네임</th>
          <th>입찰가</th>
          <th>기록 시각</th>
        </tr>
      </thead>
      <tbody>
        <% bidLogs.forEach(function (log) { %>
        <tr>
          <td><%= log.nickname %></td>
          <td>₩<%= Number(log.amount).toLocaleString('ko-KR') %></td>
          <td><%= new Date(log.created_at).toLocaleString('ko-KR') %></td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </section>
</section>
<%- include('../partials/footer') %>
